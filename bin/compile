#!/usr/bin/env bash

set -e

set -o errexit    # always exit on error
set -o pipefail   # don't ignore exit codes when piping output
set -o nounset    # fail on unset variables
unset GIT_DIR     # Avoid GIT_DIR leak from previous build steps

BUILD_DIR=${1:-}
CACHE_DIR=${2:-}
ENV_DIR=${3:-}
BP_DIR=$(cd $(dirname ${0:-}); cd ..; pwd)

mkdir -p "$BUILD_DIR/.jareda_vendor/"

cd $BUILD_DIR

echo $BUILD_DIR

# Install CMake
echo "-----> Installing CMake 3.11"
curl https://cmake.org/files/v3.11/cmake-3.11.0.tar.gz --output /tmp/cmake.tar.gz

echo "CMake Downloaded"

echo "-----> Installing ..."
tar xzf /tmp/cmake.tar.gz -C /tmp

rm -rf "$BUILD_DIR/.jareda_vendor/cmake-3.11.0"

mv /tmp/cmake-3.11.0 "$BUILD_DIR/.jareda_vendor/cmake"

export PATH="$BUILD_DIR/.jareda_vendor/cmake/bin":$PATH

which cmake
echo $PATH
